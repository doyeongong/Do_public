import numpy as np
from scipy.linalg import inv

# HP filter function

def HPfilter(Y, λ):
    """
    Hodrick-Prescott filter. λ is a smooth parameter.
    Y can be a matrix
    """
    T=len(Y)
    K=np.eye(N=T-2,M=T,k=0)+(-2)*np.eye(N=T-2,M=T,k=1)+np.eye(N=T-2,M=T,k=2)
    I=np.identity(T)
    trend=inv(I+λ*(K.T)@K) @ Y
    output_gap=(Y-trend)/trend
    
    return trend, output_gap
